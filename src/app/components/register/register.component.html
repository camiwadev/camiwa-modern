<div class="cs-height_100 cs-height_lg_70"></div>

<div class="container">
  <div class="row align-items-center min-vh-80 g-4">

    <!-- Columna: Formulario -->
    <div class="col-lg-6 order-2 order-lg-1">
      <form [formGroup]="form" (ngSubmit)="submit()" class="cs-form_card cs-style1 cs-box_shadow cs-white_bg p-4 rounded-4">
        <div class="cs-form_card_in">

          <!-- <h2 id="patient-welcome" class="cs-form_title text-center">Crear cuenta</h2> -->
          <h3 style="text-align: center;">Únete a <span class="brand">Camiwa</span></h3>
      <p>Pacientes y profesionales conectados en un solo lugar.</p>
          <!-- Selector de rol -->
          <div class="d-flex justify-content-center gap-2 mt-3">
            <button type="button"
                    (click)="setRole('patient')"
                    class="btn"
                    [ngClass]="{ 'btn-primary': isPatient(), 'btn-outline-primary': !isPatient() }">
              Soy paciente <i class="fa fa-user"></i>
            </button>
            <button type="button"
                    (click)="setRole('profesional')"
                    class="btn"
                    [ngClass]="{ 'btn-primary': isProfessional(), 'btn-outline-primary': !isProfessional() }">
              Soy profesional <i class="far fa-user"></i>
            </button>
          </div>

          <div class="cs-height_30 cs-height_lg_30"></div>

          <!-- Campos comunes -->
          <div *ngIf="!showProWizard()">
          <div class="cs-height_20 cs-height_lg_20"></div>
          <div class="cs-form_field_wrap">
            <input type="email" formControlName="email" class="cs-form_field" placeholder="Correo">
            <small class="text-danger" *ngIf="f['email'].touched && f['email'].invalid">Correo inválido.</small>
          </div>

          <div class="cs-height_20 cs-height_lg_20"></div>
          <!-- Contraseña -->
          <div class="cs-form_field_wrap cs-relative">
            <input
              [type]="showPassword ? 'text' : 'password'"
              formControlName="password"
              class="cs-form_field cs-pr-44"
              placeholder="Contraseña"
              autocomplete="new-password" />

            <button
              type="button"
              class="cs-eye_btn"
              (click)="showPassword = !showPassword"
              [attr.aria-label]="showPassword ? 'Ocultar contraseña' : 'Mostrar contraseña'">

              <!-- OJO: invertimos las condiciones -->
              <!-- Estado oculto (showPassword = false) -> mostrar OJO TACHADO -->
              <svg *ngIf="!showPassword" xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none">
                <path d="M2 12s3.5-7 10-7 10 7 10 7-3.5 7-10 7S2 12 2 12Z" stroke="currentColor" stroke-width="2"/>
                <circle cx="12" cy="12" r="3" stroke="currentColor" stroke-width="2"/>
                <line x1="3" y1="3" x2="21" y2="21" stroke="currentColor" stroke-width="2"/>
              </svg>

              <!-- Estado visible (showPassword = true) -> mostrar OJO ABIERTO -->
              <svg *ngIf="showPassword" xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none">
                <path d="M2 12s3.5-7 10-7 10 7 10 7-3.5 7-10 7S2 12 2 12Z" stroke="currentColor" stroke-width="2" />
                <circle cx="12" cy="12" r="3" stroke="currentColor" stroke-width="2"/>
              </svg>
            </button>

            <small class="text-danger" *ngIf="f['password'].touched && f['password'].invalid">
              Mínimo 6 caracteres.
            </small>
          </div>
          <div class="cs-height_20 cs-height_lg_20"></div>

          <div class="cs-form_field_wrap cs-relative">
            <input
            [type]="showConfirm ? 'text' : 'password'"
            formControlName="passwordConfirm"
            class="cs-form_field cs-pr-44"
            placeholder="Confirmar contraseña"
            autocomplete="new-password"/>

            <button
              type="button"
              class="cs-eye_btn"
              (click)="showPassword = !showPassword"
              [attr.aria-label]="showPassword ? 'Ocultar contraseña' : 'Mostrar contraseña'">

             
              <svg *ngIf="!showPassword" xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none">
                <path d="M2 12s3.5-7 10-7 10 7 10 7-3.5 7-10 7S2 12 2 12Z" stroke="currentColor" stroke-width="2"/>
                <circle cx="12" cy="12" r="3" stroke="currentColor" stroke-width="2"/>
                <line x1="3" y1="3" x2="21" y2="21" stroke="currentColor" stroke-width="2"/>
              </svg>

              <svg *ngIf="showPassword" xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none">
                <path d="M2 12s3.5-7 10-7 10 7 10 7-3.5 7-10 7S2 12 2 12Z" stroke="currentColor" stroke-width="2" />
                <circle cx="12" cy="12" r="3" stroke="currentColor" stroke-width="2"/>
              </svg>
            </button>

            <small class="text-danger" *ngIf="f['passwordConfirm'].touched && f['passwordConfirm'].invalid">
              Mínimo 6 caracteres.
            </small>
          </div>
          </div>


          <!-- Paciente -->
          <div *ngIf="isPatient() && !showProWizard()" class="mt-3" formGroupName="patient">
            <h5 class="mb-2">Datos de paciente</h5>
            <div class="cs-form_field_wrap">
              <input type="text" formControlName="fullName" class="cs-form_field" placeholder="Nombres">
              <small class="text-danger" *ngIf="form.get('patient.fullName')?.touched && form.get('patient.fullName')?.invalid">
                Requerido (mín. 3)
              </small>
            </div>
          </div>
          <div *ngIf="isPatient() && !showProWizard()" class="mt-3" formGroupName="patient">
            <div class="cs-form_field_wrap">
              <input type="text" formControlName="lastname" class="cs-form_field" placeholder="Apellido">
              <small class="text-danger" *ngIf="form.get('patient.lastname')?.touched && form.get('patient.lastname')?.invalid">
                Requerido (mín. 3)
              </small>
            </div>
          </div>

          <!-- WIZARD PROFESIONAL (sin forms anidados) -->
          <div class="multisteps-form__form" id="wizard" role="form">
            <div class="wrapper" *ngIf="showProWizard()" [formGroup]="proWizard">

              <!-- Header/progreso -->
              <div class="steps-area steps-area-fixed">
                <div class="image-holder d-none d-md-block">
                  <img src="assets/specialist-register/img/side-img.jpg" alt="">
                </div>
                <div class="steps clearfix">
                  <ul class="tablist multisteps-form__progress">
                    <li class="multisteps-form__progress-btn"
                        [class.js-active]="proStep()===1"
                        [class.js-complete]="proStep()>1"
                        (click)="goStep(1)"><span>1</span></li>

                    <li class="multisteps-form__progress-btn"
                        [class.js-active]="proStep()===2"
                        [class.js-complete]="proStep()>2"
                        (click)="goStep(2)"><span>2</span></li>

                  <!--   <li class="multisteps-form__progress-btn last"
                        [class.js-active]="proStep()===3"
                        (click)="goStep(3)"><span>3</span></li> -->
                  </ul>
                </div>
              </div>

              <!-- Contenido de pasos -->
              <div class="multisteps-form__content">
                <div class="form-area position-relative">

                  <!-- Paso 1 -->
                  <div *ngIf="proStep()===1" class="js-active" data-animation="slideHorz" [formGroup]="pwPersonal">
                    <div class="wizard-forms">
                      <div class="inner pb-100 clearfix">
                        <div class="form-content pera-content">
                          <div class="step-inner-content">
                            <span class="step-no">Paso 1</span>
                            <h2>Información personal</h2>
                            <p>Por favor complete su información personal.</p>

                            <div class="form-inner-area">
                              <input type="text" class="form-control" placeholder="Nombre completo *" formControlName="full_name">
                              <div class="cs-form_field_wrap cs-select_arrow">
                                <input type="text"
                                      class="form-control"
                                      placeholder="Apellido *"
                                      formControlName="lastname">
                                <small class="text-danger"
                                      *ngIf="pwPersonal.get('lastname')?.touched && pwPersonal.get('lastname')?.invalid">
                                  Requerido (mín. 2)
                                </small>

                                <div class="input-group">
                                  <select
                                    class="form-select"
                                    formControlName="phoneCode"
                                    aria-label="Código país"
                                    style="flex:0 0 9rem; max-width:9rem"> <!-- ~144px -->
                                    <option value="" disabled>+Código</option>
                                    <option *ngFor="let c of americasCountries" [value]="c.dial">
                                      {{ c.flag }} {{ c.name }} ({{ c.dial }})
                                    </option>
                                  </select>
                                
                                  <input
                                    type="tel"
                                    class="form-control"
                                    placeholder="Número sin código *"
                                    formControlName="phoneLocal"
                                    inputmode="numeric" />
                                </div>
                                
                              </div>
                              <small class="text-danger" *ngIf="pwPersonal.get('phoneLocal')?.touched && pwPersonal.get('phoneLocal')?.invalid">
                                Ingresa un número válido (mín. 6 dígitos).
                              </small>
                              <div class="cs-form_field_wrap cs-select_arrow">
                                <select class="cs-form_field form-select" formControlName="country" aria-label="País *">
                                <option value="" disabled selected>Selecciona país *</option>
                                <option *ngFor="let c of americasCountries" [value]="c.code">
                                  {{ c.flag }} {{ c.name }}
                                </option>
                              </select>
                              </div>
                              <div class="cs-form_field_wrap cs-select_arrow">

                              <select class="cs-form_field form-select" formControlName="city" [disabled]="!citiesOptions.length" aria-label="Ciudad *">
                                <option value="" disabled selected>Selecciona ciudad *</option>
                                <option *ngFor="let city of citiesOptions" [value]="city">{{ city }}</option>
                              </select>
                              </div>
                              <input type="text" class="form-control" placeholder="Dirección completa *" formControlName="address">

                            
                            </div>
                            <div class="upload-documents mt-3">
                              <h3>Cargue su documento de identidad:</h3>
                              <ngx-awesome-uploader
                                [adapter]="adapterIdentity"
                                [captions]="captions"
                                [showPreviewContainer]="true">
                              </ngx-awesome-uploader>
                              <small class="text-muted d-block mt-1">
                                La URL se guardará en <code>personal.idDocumentUrl</code>.
                              </small>
                            </div>
                            <div class="gender-selection">
                              <h3>Género:</h3>
                              <label><input type="radio" value="Male"   formControlName="gender"><span class="checkmark"></span>Masculino</label>
                              <label><input type="radio" value="Female" formControlName="gender"><span class="checkmark"></span>Femenino</label>
                              <label><input type="radio" value="Other"  formControlName="gender"><span class="checkmark"></span>Otro</label>
                            </div>

                            
                            

                          </div>
                        </div>
                      </div>

                      <!-- <div class="actions">
                        <button type="button" class="btn btn-accent"
                                [disabled]="!pwPersonal.valid"
                                (click)="nextStep()">
                          Siguiente <i class="fa fa-arrow-right"></i>
                        </button>
                      </div> -->
                      <!-- Acciones Paso 1 -->
                      <div class="actions d-flex gap-2">
                        <button type="button" class="btn btn-outline" (click)="prevStep()" [disabled]="proStep()===1">
                          <i class="fa fa-arrow-left"></i> Anterior
                        </button>
                        <button type="button" class="btn btn-accent" (click)="nextStep()">
                          Siguiente <i class="fa fa-arrow-right"></i>
                        </button>
                        
                       <!--  <button type="button" class="btn btn-accent"
                                [disabled]="!pwPersonal.valid"
                                (click)="nextStep()">
                          Siguiente <i class="fa fa-arrow-right"></i>
                        </button> -->
                      </div>

                    </div>
                  </div>

                  <!-- Paso 2 -->
                  <div *ngIf="proStep()===2" data-animation="slideHorz" [formGroup]="pwProf">
                    <div class="wizard-forms">
                      <div class="inner pb-100 clearfix">
                        <div class="form-content pera-content">
                          <div class="step-inner-content">
                            <span class="step-no bottom-line">Paso 2</span>
                            <div class="step-progress float-right">
                              <span>2 de 3 completado</span>
                              <div class="step-progress-bar">
                                <div class="progress">
                                  <div class="progress-bar" [style.width.%]="progressPct()"></div>
                                </div>
                              </div>
                            </div>

                            <h2>Información profesional</h2>
                            <div class="language-select">
                              <p>Seleccione la profesión a la que pertenece: </p>
                              <ng-multiselect-dropdown
                                name="category"
                                [(ngModel)]="formDataModel.category"
                                [data]="(categoriesOptions$ | async) ?? []"
                                [settings]="dropdownSettingsCategory"     
                                [placeholder]="'Seleccione Profesión'"
                                [disabled]="false"
                                (ngModelChange)="onCategoryChanged()">
                              </ng-multiselect-dropdown>
                            </div>
                            
                            <div class="language-select" [hidden]="!global.categorySelected">
                              <p>Seleccione la especialidad: </p>
                              <ng-multiselect-dropdown
                                name="specialty"
                                [(ngModel)]="formDataModel.especialidades"
                                [data]="(especialidadOptionsFiltered$ | async) ?? []"
                                [settings]="dropdownSettingsSpecialties"
                                [placeholder]="'Seleccione especialidad'">
                              </ng-multiselect-dropdown>
                            </div>
                            

                            <!-- <div class="language-select">
                              <p>Seleccione la profesión a la que pertenece:</p>
                              <ng-multiselect-dropdown
                                formControlName="category"
                                [data]="categoriesOptions"
                                [settings]="dropdownSettingsCategory">
                              </ng-multiselect-dropdown>
                            </div>
                            
                            <div class="language-select" *ngIf="(pwProf.get('category')?.value || []).length">
                              <ng-multiselect-dropdown
                                formControlName="specialties"
                                [data]="especialidadOptionsFiltered"
                                [settings]="dropdownSettingsSpecialties">
                              </ng-multiselect-dropdown>
                            </div> -->
                            

                          </div>
                        </div>
                      </div>

                      <div class="actions d-flex gap-2">
                        <!-- <button type="button" class="btn btn-outline" (click)="prevStep()">
                          <i class="fa fa-arrow-left"></i> Ant.
                        </button>
                        <button type="button" class="btn btn-accent" (click)="nextStep()">
                          Sig. <i class="fa fa-arrow-right"></i>
                        </button> -->
                       <!--  <button type="button" class="btn btn-accent" (click)="finishOnboardingSimple()">
                          Finalizar (simple) <i class="fa fa-check"></i>
                        </button> -->
                        <!-- Acciones Paso 2 -->
                        <div class="actions d-flex gap-2">
                          <button type="button" class="btn btn-outline" (click)="prevStep()">
                            <i class="fa fa-arrow-left"></i> Anterior
                          </button>
                          <button type="button" class="btn btn-accent" (click)="finishOnboardingSimple()">
                            Finalizar (simple) <i class="fa fa-check"></i>
                          </button>
                        </div>

                      </div>
                    </div>
                  </div>

                  <!-- Paso 3 -->
                 <!--  <div *ngIf="proStep()===3" data-animation="slideHorz" [formGroup]="pwLaboral">
                    <div class="wizard-forms">
                      <div class="inner pb-100 clearfix">
                        <div class="form-content pera-content">
                          <div class="step-inner-content">
                            <span class="step-no bottom-line">Paso 3</span>
                            <div class="step-progress float-right">
                              <span>3 de 3 completado</span>
                              <div class="step-progress-bar">
                                <div class="progress">
                                  <div class="progress-bar" [style.width.%]="progressPct()"></div>
                                </div>
                              </div>
                            </div>

                            <h2>Información laboral</h2>
                            <p>Ingrese la información necesaria para la atención de sus clientes.</p>

                            <div class="step-content-area">
                              <div class="budget-area">
                                <div class="opti-list">
                                  <div>
                                    <p>¿Qué días atenderá?</p>
                                    <ul class="d-flex" formArrayName="days">
                                      <li *ngFor="let c of daysFA.controls; let i = index">
                                        <label style="cursor:pointer;">
                                          <input type="checkbox" [formControlName]="i">
                                          {{ ['LU','MA','MI','JU','VI','SA','DO'][i] }}
                                        </label>
                                      </li>
                                    </ul>
                                    <small class="text-danger" *ngIf="!anyDaySelected && pwLaboral.touched">
                                      Selecciona al menos un día.
                                    </small>
                                  </div>
                                </div>
                              </div>
                            </div>

                          </div>
                        </div>
                      </div>

                      <button type="button"
                              class="cs-btn cs-style1 cs-btn_lg w-100 btn btn-accent"
                              (click)="finishOnboarding()">
                        <span>Finalizar</span> <i class="fa fa-arrow-right"></i>
                      </button>
                    </div>
                  </div> -->

                </div>
              </div>
              <!-- /Contenido de pasos -->

            </div>
          </div>
          <!-- /Wizard profesional -->

          <div class="cs-height_20 cs-height_lg_20"></div>

        
          <!-- Términos (paciente y profesional) -->
          <div class="form-check" *ngIf="!showProWizard()">
            <input class="form-check-input" type="checkbox" id="terms" formControlName="terms">
            <label class="form-check-label" for="terms" (click)="global.setRouterActive('terms')" style="cursor: pointer;">
              Acepto términos y condiciones
            </label>
            <div class="text-danger" *ngIf="form.get('terms')?.touched && form.get('terms')?.invalid">Requerido.</div>
          </div>

          <div class="cs-height_20 cs-height_lg_20"></div>

          <!-- Botones finales -->
          <button *ngIf="isPatient() && !loading() && !showProWizard()" class="cs-btn btn btn-accent cs-btn_lg w-100" type="submit">
            Crear cuenta
          </button>
          <button *ngIf="isProfessional() && !loading() && !showProWizard()" class="cs-btn btn btn-accent cs-btn_lg w-100" type="submit">
            Continuar con el registro
          </button>
          

          <!-- Loader global -->
          <div *ngIf="loading()" class="text-center mt-3">
            <i class="fa fa-spinner fa-spin fa-2x"></i>
            <p>Creando tu cuenta...</p>
          </div>

          <div class="cs-height_30 cs-height_lg_30"></div>
          <div class="cs-form_footer text-center">
            ¿Ya tienes cuenta? <a (click)=" global.setRouterActive('login')" style="cursor:pointer;">Ingresa</a>
          </div>

        </div>
      </form>
    </div>

    <!-- Columna: Imagen -->
   <!-- Columna: Imagen / Hero visual -->
<div class="col-lg-6 order-1 order-lg-2">
  <figure class="login-hero-v2">
    <!-- Usa WEBP si lo tienes; fallback a PNG/JPG -->
    <picture>
      <source [srcset]="registerHeroImage()" type="image/webp">
      <img 
        [src]="registerHeroImage()" 
        alt="Pacientes y profesionales conectados" 
        loading="lazy" decoding="async" 
        width="840" height="680" />
    </picture>

    <!-- Overlay degradado para contraste de textos -->
    <div class="login-hero-v2__shade"></div>

    <!-- Borde interior luminoso sutil -->
    <div class="login-hero-v2__inner-border"></div>

    <!-- Badge/etiqueta opcional -->
    <div class="login-hero-v2__badge d-none d-md-flex">
      <i class="fa fa-shield-alt"></i> Cuidado seguro
    </div>

    <!-- Texto superpuesto -->
    <figcaption class="login-hero-v2__caption d-none d-md-block">
      
    </figcaption>

    <!-- Decoraciones suaves -->
    <span class="blob blob--1"></span>
    <span class="blob blob--2"></span>
  </figure>
</div>


  </div>
</div>

<!-- Toast -->
<div *ngIf="toastVisible()" class="toast-wrap">
  <div class="toast" [ngClass]="{
      'success': toast()?.level==='success',
      'info':    toast()?.level==='info',
      'warn':    toast()?.level==='warn',
      'error':   toast()?.level==='error'
    }">
    <span>{{ toast()?.message }}</span>
    <button type="button" class="close" (click)="hideToast()">×</button>
  </div>
</div>

<div class="cs-height_90 cs-height_lg_80"></div>
