<div class=" cs-height_lg_70"></div>
<div class="cs-bg" data-src="assets/img/page_head_bg.svg">
  <div class="cs-height_100 cs-height_lg_70"></div>
  <div class="container">
    <div class="cs-collection_card">
      <div class="cs-collection_img">
        <img src="assets/img/general/collection_details.jpeg" alt="Collection Details">
      </div>
      <div class="cs-collection_bottom">
        <div class="cs-collection_avatar">
          <img
          [src]="avatarPreviewUrl || getAvatarUrl()"
          alt="Avatar"
          style="width:100%; height:100%; object-fit:cover;"
        />
        
        </div>
        
        
        <div class="cs-collection_info">
          <div class="cs-collection_info_in cs-white_bg">
            <div class="cs-collection_info_left">
              <h2 class="cs-collection_avatar_name">{{global.previewRequest.profession}}</h2>
              <div class="cs-collection_user"><span>{{global.previewRequest.city}}</span></div>
              <a class="cs-btn cs-style1">
                <span><i class="far fa-star"></i> {{global.previewRequest.address}}</span>
              </a>
              <span class="cs-btn cs-style1">
                <span>
                  <!-- icono -->
                  <svg width="21" height="21" viewBox="0 0 21 21" fill="none" xmlns="http://www.w3.org/2000/svg"><g clip-path="url(#c)"><path d="M10.8914 11.9518C11.7635 11.9518 12.4704 11.2449 12.4704 10.3729C12.4704 9.50086 11.7635 8.79395 10.8914 8.79395C10.0194 8.79395 9.3125 9.50086 9.3125 10.3729C9.3125 11.2449 10.0194 11.9518 10.8914 11.9518Z" fill="white"/><path d="M10.8914 3.93231C11.7635 3.93231 12.4704 3.22539 12.4704 2.35336C12.4704 1.48133 11.7635 0.774414 10.8914 0.774414C10.0194 0.774414 9.3125 1.48133 9.3125 2.35336C9.3125 3.22539 10.0194 3.93231 10.8914 3.93231Z" fill="white"/><path d="M10.8914 19.9704C11.7635 19.9704 12.4704 19.2635 12.4704 18.3914C12.4704 17.5194 11.7635 16.8125 10.8914 16.8125C10.0194 16.8125 9.3125 17.5194 9.3125 18.3914C9.3125 19.2635 10.0194 19.9704 10.8914 19.9704Z" fill="white"/></g><defs><clipPath id="c"><rect width="20.2105" height="20.2105" fill="white" transform="translate(0.0546875 0.267578)"/></clipPath></defs></svg>
                </span>
              </span>
            </div>

            <div class="cs-collection_right">
              <div class="cs-collection_list_wrap">
                <ul class="cs-collection_list cs-white_bg cs-mp0">
                  <li><div class="cs-collection_list_title">Profesión</div><div class="cs-collection_list_number">{{global.previewRequest.profession}}</div></li>
                  <li><div class="cs-collection_list_title">Especialista</div><div class="cs-collection_list_number">{{global.previewRequest.profession}}</div></li>
                  <li><div class="cs-collection_list_title">Calificación</div><div class="cs-collection_list_number">0</div></li>
                  <li><div class="cs-collection_list_title">Servicios</div><div class="cs-collection_list_number">0</div></li>
                </ul>
              </div>
            </div>

          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="container">
  <div class="cs-prifile_wrap" style="padding-top: 10px;">
    <!-- LADO IZQUIERDO (MENÚ) -->
    <div class="cs-profile_left">
      <div class="cs-profile_sidebar cs-white_bg cs-box_shadow">
        <div class="cs-profile_info" style="padding-top: 10px;">
          <div class=" mb-3" style="text-align: center;">

            <input type="file"
                   id="proAvatarInput"
                   hidden
                   accept="image/*"
                   (change)="onAvatarChange($event)">
            
            <button class="cs-btn cs-style1 mt-2"
                    type="button"
                    (click)="triggerAvatarInput()">
              <span><i class="bi bi-camera-fill me-1"></i> Cambiar foto</span>
            </button> 
            </div>
          <h3 class="cs-profile_title">{{global.previewRequest.full_name}}</h3>
          <ul class="cs-profile_meta cs-mp0">
            <li>{{global.previewRequest.profession}}</li>
            <li>{{global.previewRequest.profession}}</li>
          </ul>
        </div>

        <div class="cs-height_30 cs-height_lg_30"></div>
        <ul class="cs-profile_nav cs-mp0">
          <li>
            <a href="" (click)="$event.preventDefault(); setTab('perfil')"
               [class.active]="activeTab === 'perfil'">
              <!-- ícono -->
              <span>Información de perfil</span>
            </a>
          </li>
          <li>
            <a href="" (click)="$event.preventDefault(); setTab('servicios')"
               [class.active]="activeTab === 'servicios'">
              <span>Mis servicios</span>
            </a>
          </li>
          <li>
            <a href="" (click)="$event.preventDefault(); setTab('resenas')"
               [class.active]="activeTab === 'resenas'">
              <span>Reseñas</span>
            </a>
          </li>
          <li>
            <a href="" (click)="$event.preventDefault(); setTab('agenda')"
               [class.active]="activeTab === 'agenda'">
              <span>Agenda</span>
            </a>
          </li>
        </ul>
      </div>
    </div>

    <!-- LADO DERECHO (CONTENIDO) -->
    <div class="cs-profile_right">
      <div class="cs-height_30 cs-height_lg_30"></div>

      <!-- Título cambia con la pestaña -->
      <h2 class="cs-section_heading cs-style1">
        <ng-container *ngIf="activeTab === 'perfil'">Información de perfil</ng-container>
        <ng-container *ngIf="activeTab === 'servicios'"></ng-container>
        <ng-container *ngIf="activeTab === 'resenas'">Reseñas</ng-container>
        <ng-container *ngIf="activeTab === 'agenda'">Agenda</ng-container>
      </h2>

      <div class="cs-height_25 cs-height_lg_25"></div>

      <!-- AGENDA (calendario a lo ancho) -->
      <section *ngIf="activeTab === 'agenda'">
        <div class="cs-card cs-white_bg p-2">
          <app-booking-calendar></app-booking-calendar>
        </div>
      </section>
      

     
      <!-- Pestaña PERFIL -->
<section *ngIf="activeTab === 'perfil'">
  <!-- Header de la sección con acciones -->
  <div class="d-flex justify-content-between align-items-center mb-3">

    <div class="d-flex gap-2">
      <button
        *ngIf="!editMode"
        type="button"
        class="cs-btn cs-style1"
        (click)="toggleEdit()">
        <span><i class="bi bi-pencil-square me-1"></i> Editar</span>
      </button>

      <button
        *ngIf="editMode"
        type="button"
        class="cs-btn cs-style2"
        (click)="toggleEdit()">
        <span><i class="bi bi-x-circle me-1"></i> Cancelar</span>
      </button>

      <button
        *ngIf="editMode"
        [disabled]="saving"
        type="button"
        class="cs-btn cs-style1"
        (click)="onSaveProfile()">
        <span>
          <i class="bi" [ngClass]="saving ? 'bi-arrow-repeat' : 'bi-check2-circle'"></i>
          {{ saving ? 'Actualizando…' : 'Actualizar' }}
        </span>
      </button>
    </div>
  </div>

  <!-- MODO LECTURA -->
  <div *ngIf="!editMode" class="row">
    <div class="col-lg-6">
      <div class="cs-card cs-white_bg p-3 mb-3 rounded">
        <h5 class="mb-1">Nombre completo</h5>
        <p class="mb-0 text-muted">{{ global.previewRequest.full_name }}</p>
      </div>
      <div class="cs-card cs-white_bg p-3 mb-3 rounded">
        <h5 class="mb-1">Profesión</h5>
        <p class="mb-0 text-muted">{{ global.previewRequest.profession }}</p>
      </div>
      <div class="cs-card cs-white_bg p-3 mb-3 rounded">
        <h5 class="mb-1">Biografía</h5>
        <p class="mb-0 text-muted">{{ global.previewRequest.biography || global.previewRequest.type }}</p>
      </div>
    </div>

    <div class="col-lg-6">
      <div class="cs-card cs-white_bg p-3 mb-3 rounded">
        <h5 class="mb-1">Apellido</h5>
        <p class="mb-0 text-muted">{{ global.previewRequest.full_name || '—' }}</p>
      </div>
      <div class="cs-card cs-white_bg p-3 mb-3 rounded">
        <h5 class="mb-1">Custom URL</h5>
        <p class="mb-0 text-muted">www.camiwa.com/{{ global.previewRequest.full_name || 'tu-usuario' }}</p>
      </div>
      <!-- <div class="cs-card cs-style2 cs-btn_lg w-100 mb-3">
        <i class="fab fa-facebook-f me-2"></i>
        <a [href]="global.previewRequest.facebook || 'https://facebook.com/username'" target="_blank">
          {{ global.previewRequest.facebook || 'facebook.com/username' }}
        </a>
      </div>
      <div class="cs-card cs-style2 cs-btn_lg w-100 mb-3">
        <i class="fab fa-twitter me-2"></i>
        <a [href]="global.previewRequest.twitter || 'https://twitter.com/username'" target="_blank">
          {{ (global.previewRequest.twitter || 'username') | lowercase }}
        </a>
      </div>
      <div class="cs-card cs-style2 cs-btn_lg w-100">
        <i class="fab fa-linkedin-in me-2"></i>
        <a [href]="global.previewRequest.linkedin || 'https://linkedin.com/in/username'" target="_blank">
          {{ global.previewRequest.linkedin || 'linkedin.com/in/username' }}
        </a>
      </div> -->
    </div>
  </div>

  <!-- MODO EDICIÓN -->
  <form *ngIf="editMode" [formGroup]="profileForm" (ngSubmit)="onSaveProfile()">
    <div class="row">
      <div class="col-lg-6">
        <div class="cs-card cs-white_bg p-3 mb-3 rounded">
          <h5 class="mb-1">Nombre completo</h5>
          <input type="text" class="form-control" formControlName="full_name">
        </div>
        <div class="cs-card cs-white_bg p-3 mb-3 rounded">
          <h5 class="mb-1">Profesión</h5>
          <input type="text" class="form-control" formControlName="profession">
        </div>
        <div class="cs-card cs-white_bg p-3 mb-3 rounded">
          <h5 class="mb-1">Biografía</h5>
          <textarea class="form-control" rows="3" formControlName="biography"></textarea>
        </div>
      </div>

      <div class="col-lg-6">
        <div class="cs-card cs-white_bg p-3 mb-3 rounded">
          <h5 class="mb-1">Username</h5>
          <input type="text" class="form-control" formControlName="username">
        </div>
        
      </div>
    </div>

    <!-- Botones también aquí por accesibilidad en móvil -->
    <div class="d-flex justify-content-center gap-2 mt-3">
      <button type="button" class="cs-btn cs-style2" (click)="toggleEdit()">
        <span>Cancelar</span>
      </button>
      <button type="submit" class="cs-btn cs-style1" [disabled]="saving">
        <span>{{ saving ? 'Actualizando…' : 'Actualizar' }}</span>
      </button>
    </div>
  </form>
</section>

      

      <!-- SERVICIOS -->
   
<section *ngIf="activeTab === 'servicios'">
  <div class="container">
    <div class="row">
      <div class="col-lg-12">

        <div class="d-flex justify-content-between align-items-center mb-3">
          <h2 class="cs-section_heading cs-style1 m-0">Mis servicios</h2>

          <button type="button"
                  class="cs-btn cs-style1"
                  (click)="toggleNewService()">
            <span>
              <i class="bi" [ngClass]="showNewService ? 'bi-dash-circle' : 'bi-plus-circle'"></i>
              {{ showNewService ? 'Cerrar' : 'Crear nuevo' }}
            </span>
          </button>
        </div>

        <!-- FORM CREAR SERVICIO -->
        <div *ngIf="showNewService" class="cs-card cs-white_bg p-3 mb-4 rounded">
          <form [formGroup]="serviceForm" (ngSubmit)="createService()">
            <div class="row g-3">
              <div class="col-md-6">
                <label class="form-label">Título del servicio</label>
                <input class="form-control" formControlName="title" placeholder="Ej: Consulta general" />
                <div class="text-danger small" *ngIf="serviceForm.get('title')?.touched && serviceForm.get('title')?.invalid">
                  El título es obligatorio (máx. 120 caracteres).
                </div>
              </div>

              <div class="col-12">
                <label class="form-label">Descripción</label>
                <textarea class="form-control" rows="3" formControlName="description" placeholder="Describe el servicio, qué incluye, tiempos, etc."></textarea>
              </div>

              <div class="col-12">
                <label class="form-label">Imágenes (opcional)</label>
                <input type="file" multiple accept="image/*" (change)="onServiceImagesSelect($event)" class="form-control" />
                <div class="form-text">Puedes seleccionar varias imágenes.</div>
              </div>

              <div class="col-12 d-flex gap-2">
                <button type="button" class="cs-btn cs-style2" (click)="toggleNewService()">Cancelar</button>
                <button type="submit" class="cs-btn cs-style1" [disabled]="creatingService">
                  <span>
                    <i class="bi" [ngClass]="creatingService ? 'bi-arrow-repeat' : 'bi-check2-circle'"></i>
                    {{ creatingService ? 'Guardando…' : 'Crear servicio' }}
                  </span>
                </button>
              </div>
            </div>
          </form>
        </div>

        <!-- LISTA DE SERVICIOS -->
        <div class="cs-activity_wrap cs-box_shadow cs-white_bg">
          <div class="d-flex align-items-center justify-content-between px-3 pt-3">
            <h6 class="m-0">Listado</h6>
            <div *ngIf="loadingServices" class="small text-muted">Cargando…</div>
          </div>

          <div class="cs-height_15"></div>

          <ul class="cs-activity_list cs-mp0">
            <li *ngFor="let s of services">
              <div class="cs-activity cs-gray_bg">
                <div class="cs-activity_avatar">
                  <img
                    [src]="pb.getFileUrl(s, (pb.normalizeFileNames(s.images)[0] || '')) || 'assets/img/avatar/avatar_21.png'"
                    alt="img">
                </div>
          
                <div class="cs-activity_right">
                  <p class="cs-activity_text mb-1">
                    <strong>{{ s.tittle || s.title }}</strong>
                  </p>
                  <p class="cs-activity_posted_by mb-0">
                    {{ s.description || '—' }}
                  </p>
                  <div class="small text-muted mt-1">
                    Creado: {{ s.created | date:'medium' }}
                  </div>
          
                  <!-- Botones acción -->
                  <div class="mt-2 d-flex gap-2">
                    <button type="button" class="cs-btn cs-style1" (click)="startEditService(s)" *ngIf="editingServiceId !== s.id">
                      <span><i class="bi bi-pencil-square me-1"></i>Editar</span>
                    </button>
                    <button type="button" class="cs-btn cs-style2" (click)="deleteService(s)">
                      <span><i class="bi bi-trash me-1"></i>Eliminar</span>
                    </button>
                  </div>
                </div>
          
                <div class="cs-activity_icon cs-center cs-white_bg cs-accent_color">
                  <!-- placeholder -->
                  <svg width="24" height="24" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/></svg>
                </div>
              </div>
          
              <!-- FORM EDICIÓN INLINE -->
              <div *ngIf="editingServiceId === s.id" class="cs-card cs-white_bg p-3 mt-2 rounded">
                <form [formGroup]="serviceEditForm" (ngSubmit)="saveEditService(s)">
                  <div class="row g-3">
                    <div class="col-md-6">
                      <label class="form-label">Título</label>
                      <input class="form-control" formControlName="title" />
                    </div>
                    <div class="col-12">
                      <label class="form-label">Descripción</label>
                      <textarea class="form-control" rows="3" formControlName="description"></textarea>
                    </div>
          
                    <!-- imágenes existentes: marcar para quitar -->
                    <div class="col-12" *ngIf="pb.normalizeFileNames(s.images).length">
                      <label class="form-label d-block">Imágenes existentes</label>
                      <div class="d-flex flex-wrap gap-3">
                        <label class="d-flex flex-column align-items-center" *ngFor="let name of pb.normalizeFileNames(s.images)">
                          <img [src]="pb.getFileUrl(s, name)" style="height:70px;border-radius:8px;object-fit:cover">
                          <div class="form-check mt-1">
                            <input class="form-check-input" type="checkbox"
                                   [checked]="serviceEditKeep.includes(name)"
                                   (change)="toggleRemoveExistingImage(name)">
                            <small class="form-check-label">Conservar</small>
                          </div>
                        </label>
                      </div>
                    </div>
          
                    <div class="col-md-6">
                      <label class="form-label">Nuevas imágenes (opcional)</label>
                      <input type="file" multiple accept="image/*" class="form-control" (change)="onServiceEditImagesSelect($event)">
                      <div class="form-text">Las nuevas se añadirán a las seleccionadas para conservar.</div>
                    </div>
          
                    <div class="col-md-6 d-flex align-items-end">
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" [(ngModel)]="serviceEditClearAll" name="clearAll">
                        <label class="form-check-label">Eliminar todas las imágenes</label>
                      </div>
                    </div>
          
                    <div class="col-12 d-flex gap-2">
                      <button type="button" class="cs-btn cs-style2" (click)="cancelEditService()">Cancelar</button>
                      <button type="submit" class="cs-btn cs-style1">
                        <span><i class="bi bi-check2-circle me-1"></i>Guardar cambios</span>
                      </button>
                    </div>
                  </div>
                </form>
              </div>
          
            </li>
          
            <li *ngIf="!loadingServices && !services.length" class="p-3">
              <div class="text-center text-muted">Aún no tienes servicios. Usa “Crear nuevo”.</div>
            </li>
          </ul>
          
        </div>

      </div>
    </div>
  </div>
</section>


      <!-- RESEÑAS -->
      <section *ngIf="activeTab === 'resenas'">
        <div class="cs-card cs-white_bg p-3 rounded">Contenido de reseñas…</div>
      </section>

    </div>
  </div>
</div>

<div class="cs-height_100 cs-height_lg_70"></div>
